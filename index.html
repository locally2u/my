<!doctype html>
<html lang="ms">
<head>
  <link rel="manifest" href="./manifest.json">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#A67734">
  <title>Pipah Cookies ‚Äî Kebahagiaan Setiap Hari</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDKs (Versi 8 untuk kestabilan Web Lama/PWA) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <style>
    /* --- GLASSMORPHISM & THEME --- */
    :root {
      --primary: #A67734;
      --primary-light: #dfb27c;
      --bg: #FDFBF7;
      --glass: rgba(255, 255, 255, 0.85);
      --radius: 24px;
      --shadow: 0 10px 30px -10px rgba(166, 119, 52, 0.15);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body {
      margin: 0; padding-bottom: 100px;
      font-family: "DM Sans", sans-serif;
      background: var(--bg); color: #4a2e19;
      background-image: radial-gradient(#A67734 0.5px, transparent 0.5px);
      background-size: 20px 20px;
      user-select: none;
    }
    h1, h2, h3, button { font-family: "Fredoka", sans-serif; }

    /* LOADING SCREEN */
    #loader {
        position: fixed; inset: 0; background: var(--bg); z-index: 9999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: opacity 0.5s;
    }
    .spin-cookie { font-size: 60px; animation: spin 2s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* HEADER */
    .app-header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: rgba(253, 251, 247, 0.9); backdrop-filter: blur(10px);
      padding: 15px 20px; border-bottom: 1px solid rgba(0,0,0,0.05);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-size: 20px; font-weight: 700; color: var(--primary); }

    /* HERO BANNERS (SWIPE) */
    .hero-container {
        display: flex; gap: 15px; overflow-x: auto; padding: 20px;
        scroll-snap-type: x mandatory; margin-top: 70px;
        scrollbar-width: none;
    }
    .hero-container::-webkit-scrollbar { display: none; }
    .hero-card {
        min-width: 90%; height: 200px; border-radius: 20px;
        background-color: #ddd; background-size: cover; background-position: center;
        scroll-snap-align: center; position: relative; overflow: hidden;
        box-shadow: var(--shadow);
    }
    .hero-text {
        position: absolute; bottom: 0; left: 0; right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        color: white; padding: 20px; padding-top: 40px;
    }

    /* CATEGORY TABS */
    .cat-scroll { display: flex; gap: 10px; padding: 0 20px; margin-bottom: 20px; overflow-x: auto; scrollbar-width: none; }
    .cat-btn {
        padding: 8px 18px; background: white; border: 1px solid #eee; border-radius: 30px;
        color: #888; white-space: nowrap; font-size: 14px; transition: 0.2s;
    }
    .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(166,119,52,0.3); }

    /* PRODUCT GRID */
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
    .card {
        background: white; border-radius: 20px; padding: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.03); display: flex; flex-direction: column;
        transition: transform 0.1s;
    }
    .card:active { transform: scale(0.97); }
    .card-img {
        width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 15px;
        background: #f0f0f0; margin-bottom: 10px;
    }
    .add-btn {
        margin-top: auto; background: var(--primary); color: white; border: none;
        width: 100%; padding: 8px; border-radius: 12px; font-size: 13px;
        display: flex; align-items: center; justify-content: center; gap: 5px;
    }

    /* BOTTOM NAV */
    .nav {
        position: fixed; bottom: 20px; left: 20px; right: 20px;
        background: #222; height: 65px; border-radius: 35px;
        display: flex; justify-content: space-around; align-items: center;
        color: #777; z-index: 500; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .nav-item { font-size: 22px; position: relative; transition: 0.3s; }
    .nav-item.active { color: #fff; transform: translateY(-3px); text-shadow: 0 0 10px rgba(255,255,255,0.5); }
    .badge {
        position: absolute; top: -5px; right: -8px; background: #ff4757; color: white;
        font-size: 10px; width: 16px; height: 16px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center; opacity: 0;
        transition: 0.3s;
    }
    .badge.show { opacity: 1; transform: scale(1); }

    /* CART DRAWER */
    .drawer {
        position: fixed; inset: 0; background: white; z-index: 1000;
        transform: translateY(100%); transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        display: flex; flex-direction: column;
    }
    .drawer.open { transform: translateY(0); }
    .drawer-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .drawer-body { flex: 1; overflow-y: auto; padding: 20px; }
    .drawer-footer { padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; }

  </style>
</head>
<body>

  <!-- LOADING -->
  <div id="loader">
      <div class="spin-cookie">üç™</div>
      <p style="margin-top:15px; font-weight:bold; color:var(--primary);">Menyiapkan Biskut...</p>
  </div>

  <!-- HEADER -->
  <header class="app-header">
      <div>
          <div style="font-size:11px; color:#888;">Selamat Datang,</div>
          <div class="brand">PipahCookies</div>
      </div>
      <div style="background:#FFF0DC; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:bold; color:var(--primary);">
          üî• Promo
      </div>
  </header>

  <!-- HOME PAGE -->
  <main id="home-view">
      
      <!-- Banners (Dynamic) -->
      <div class="hero-container" id="banner-list">
          <div class="hero-card" style="background:#eee; display:flex; align-items:center; justify-content:center; color:#999;">
              Loading Banners...
          </div>
      </div>

      <!-- Categories -->
      <div class="cat-scroll">
          <button class="cat-btn active" onclick="filterCat('all', this)">Semua</button>
          <button class="cat-btn" onclick="filterCat('Cookies', this)">Cookies</button>
          <button class="cat-btn" onclick="filterCat('Brownies', this)">Brownies</button>
          <button class="cat-btn" onclick="filterCat('Combo', this)">Combo</button>
      </div>

      <!-- Products -->
      <h3 style="padding:0 20px; margin-bottom:15px;">Menu Pilihan</h3>
      <div class="grid" id="product-list">
          <!-- Products Injected Here -->
      </div>
      <div style="height:100px;"></div>
  </main>

  <!-- CART DRAWER -->
  <div class="drawer" id="cart-drawer">
      <div class="drawer-header">
          <h2 style="margin:0;">Bakul Saya</h2>
          <button onclick="toggleCart()" style="background:none; border:none; font-size:24px;">‚úï</button>
      </div>
      <div class="drawer-body" id="cart-content">
          <!-- Cart Items -->
      </div>
      <div class="drawer-footer">
          <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:18px; margin-bottom:15px;">
              <span>Jumlah:</span>
              <span id="cart-total" style="color:var(--primary);">RM 0.00</span>
          </div>
          <input type="text" id="cust-name" placeholder="Nama Anda" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:12px; margin-bottom:10px;">
          <textarea id="cust-note" placeholder="Nota / Alamat" rows="2" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:12px; margin-bottom:10px; font-family:inherit;"></textarea>
          <button onclick="checkout()" style="width:100%; background:#25D366; color:white; padding:15px; border:none; border-radius:15px; font-weight:bold; font-size:16px;">
              <i class="fab fa-whatsapp"></i> Hantar Order
          </button>
      </div>
  </div>

  <!-- NAVIGATION -->
  <nav class="nav">
      <div class="nav-item active" onclick="window.scrollTo(0,0)"><i class="fas fa-home"></i></div>
      <div class="nav-item" onclick="toggleCart()">
          <i class="fas fa-shopping-bag"></i>
          <div class="badge" id="cart-badge">0</div>
      </div>
      <div class="nav-item" onclick="window.open('https://instagram.com','_blank')"><i class="fab fa-instagram"></i></div>
  </nav>

  <script>
    // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyA2Y2cOh3J7U916Ip0tnDDFVs2fK6sACl0",
  authDomain: "pipahcookies-21e38.firebaseapp.com",
  projectId: "pipahcookies-21e38",
  storageBucket: "pipahcookies-21e38.firebasestorage.app",
  messagingSenderId: "162482379926",
  appId: "1:162482379926:web:14d16f5a2444816876f6b7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

    // Init Firebase
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // STATE
    let products = [];
    let cart = JSON.parse(localStorage.getItem('pipah_cart')) || [];
    let settings = { whatsapp: '601121243407' }; // Default

    // STARTUP
    window.onload = function() {
        // 1. Dapatkan Settings
        db.collection('settings').doc('config').onSnapshot(doc => {
            if(doc.exists) settings = doc.data();
        });

        // 2. Dapatkan Banners (Realtime)
        db.collection('banners').onSnapshot(snap => {
            const list = document.getElementById('banner-list');
            list.innerHTML = '';
            snap.forEach(doc => {
                const b = doc.data();
                list.innerHTML += `
                    <div class="hero-card" style="background-image: url('${b.image}');">
                        <div class="hero-text"><h3>${b.title}</h3></div>
                    </div>`;
            });
            if(snap.empty) list.innerHTML = '<div style="padding:20px; text-align:center; width:100%;">Tiada Banner</div>';
        });

        // 3. Dapatkan Produk (Realtime)
        db.collection('products').onSnapshot(snap => {
            products = [];
            snap.forEach(doc => products.push({ id: doc.id, ...doc.data() }));
            renderProducts(products);
            
            document.getElementById('loader').style.opacity = 0;
            setTimeout(()=> document.getElementById('loader').style.display = 'none', 500);
        });

        updateCartUI();
    };

    // RENDER PRODUK
    function renderProducts(data) {
        const list = document.getElementById('product-list');
        list.innerHTML = '';
        data.forEach(p => {
            list.innerHTML += `
                <div class="card">
                    <img src="${p.image}" class="card-img" onerror="this.src='https://placehold.co/300?text=No+Image'">
                    <div style="font-weight:bold; margin-bottom:4px; line-height:1.2;">${p.name}</div>
                    <div style="font-size:12px; color:#888; margin-bottom:8px;">${p.category}</div>
                    <div style="margin-top:auto; font-weight:700; color:var(--primary); margin-bottom:8px;">RM ${p.price}</div>
                    <button class="add-btn" onclick="addToCart('${p.id}')">
                        <i class="fas fa-plus"></i> Tambah
                    </button>
                </div>
            `;
        });
    }

    function filterCat(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(cat === 'all') renderProducts(products);
        else renderProducts(products.filter(p => p.category === cat));
    }

    // CART LOGIC
    function addToCart(id) {
        const p = products.find(x => x.id === id);
        const item = cart.find(x => x.id === id);
        if(item) item.qty++;
        else cart.push({ ...p, qty: 1 });
        saveCart();
        
        // Animasi Badge
        const b = document.getElementById('cart-badge');
        b.style.transform = "scale(1.5)";
        setTimeout(()=> b.style.transform = "scale(1)", 200);
    }

    function saveCart() {
        localStorage.setItem('pipah_cart', JSON.stringify(cart));
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cart-content');
        const totalEl = document.getElementById('cart-total');
        const badge = document.getElementById('cart-badge');
        
        list.innerHTML = '';
        let total = 0, count = 0;

        cart.forEach((item, i) => {
            total += item.price * item.qty;
            count += item.qty;
            list.innerHTML += `
                <div style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #f0f0f0; padding-bottom:10px;">
                    <img src="${item.image}" style="width:60px; height:60px; border-radius:10px; object-fit:cover;">
                    <div style="flex:1;">
                        <div style="font-weight:bold; font-size:14px;">${item.name}</div>
                        <div style="color:#888; font-size:12px;">RM ${item.price}</div>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <button onclick="modQty(${i}, -1)" style="width:25px; height:25px; background:#eee; border:none; border-radius:5px;">-</button>
                        <span style="font-weight:bold;">${item.qty}</span>
                        <button onclick="modQty(${i}, 1)" style="width:25px; height:25px; background:var(--primary); color:white; border:none; border-radius:5px;">+</button>
                    </div>
                </div>
            `;
        });

        if(cart.length === 0) list.innerHTML = '<div style="text-align:center; padding-top:40px; color:#aaa;">Bakul kosong</div>';
        
        totalEl.innerText = "RM " + total.toFixed(2);
        badge.innerText = count;
        if(count > 0) badge.classList.add('show');
        else badge.classList.remove('show');
    }

    function modQty(i, delta) {
        cart[i].qty += delta;
        if(cart[i].qty <= 0) cart.splice(i, 1);
        saveCart();
    }

    function toggleCart() {
        document.getElementById('cart-drawer').classList.toggle('open');
    }

    function checkout() {
        if(cart.length === 0) return alert("Bakul kosong!");
        const name = document.getElementById('cust-name').value;
        const note = document.getElementById('cust-note').value;
        
        if(!name) return alert("Sila masukkan nama anda.");
        
        let msg = `Hai Pipah! Saya ${name} nak order:%0A`;
        if(note) msg += `Catatan: ${note}%0A%0A`;
        
        let total = 0;
        cart.forEach(i => {
            msg += `- ${i.name} (${i.qty})%0A`;
            total += (i.price * i.qty);
        });
        msg += `%0AJumlah: RM ${total.toFixed(2)}`;
        
        window.location.href = `https://wa.me/${settings.whatsapp}?text=${msg}`;
    }
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => console.log('SW registered!', reg))
        .catch(err => console.log('SW failed', err));
    });
  }
</script>
</body>
</html>


